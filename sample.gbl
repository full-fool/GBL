### gloabl variables including array, initialization



class Gobang extends Game
{
    #variables:
    #Map:
    int MapSize[2];
    int GridNum;  #GridNum = Mapsize[0] * Mapsize[1]
    string blank;
    #Player:
    int PlayerNumber;
    int PlayerId[PlayerNumber];
    string PlayerName[PlayerNumber];
    string PlayerSpriteName[PlayerNumber];
    #Sprite:
    int SpriteId[GridNum];
    string SpriteText[GridNum];
    int SpriteOwnerId[GridNum];
    #LastMove:
    int FormerId; #the ID of former player
    int FormerPosition[2];
    #Next Turn:
    int NextPlayerID;
    int NextSpriteID;





    #functions:
    void initialize(int MapS, int PlayerNum, Player PlayerL, string Blanksignal)
    {

        ##paraments
        int MapSize[2] = {MapS[0], MapS[1]};
        PlayerNumber = PlayerNum;
        for(int i = 0; i < PlayerNum; i++)
        {
            PlayerId[i] = Id@PlayerL[i];
            PlayerName[i] = Name@PlayerL[i];
            PlayerSpriteName[i] = PlayerSpriteName@PlayerL[i];
        }
        
        string blank = Blanksignal;
        for(int i = 0; i < MapSize[0]; i++)
        {
            for(int j = 0; j < MapSize[1]; j++)
            {
                Id@SpriteList[i][j]@GobangStatus = -1;
                Text@SpriteList[i][j]@GobangStatus = "*";
                OwnerId@SpriteList[i][j]@GobangStatus = -1;
            }
        }
        FormerId@GobangStatus = -1;
        FormerPosition[0]@GobangStatus = -1;
        FormerPosition[1]@GobangStatus = -1;
        #LatterId@GobangStatus = -1;
        #LatterPosition[0]@GobangStatus = -1;
        #LatterPosition[1]@GobangStatus = -1;
        NextPlayerID@GobangStatus = 0;
        NextSpriteID@GobangStatus = 0;
    }

    bool win()
    {
      string PlayerSprite = PlayerSpriteName@PlayerList[FormerId@GobangStatus];
      int position[2];
      position[0] = FormerPosition[0]@GobangStatus;
      position[1] = FormerPosition[1]@GobangStatus;
      int left = max(position[0] - 4, 0);
      int right = min(position[0] + 4, Mapsize[0] - 1);
      int up = max(position[1] - 4, 0);
      int down = min(position[1] + 4, Mapsize[1] - 1);

      int count;
      string PreSprite; = "*";
      #check row
      PreSprite = "*";
      count = 0;
      for(int j = left; j <= right; j++)
      {
        string curSprite = Text@SpriteList[position[0]][j]@GobangStatus;
        if(curSprite == PlayerSprite)
        {
          if(PreSprite != PlayerSprite)
          {
            count = 1;
          }
          else count++;
          if(count == 5)
            return true;
        }
        else count = 0;

        PreSprite = curSprite;
      }

      #check column
      PreSprite = "*";
      count = 0;
      for(int i = up; i <= down; i++)
      {
        string curSprite = Text@SpriteList[i][position[1]]@GobangStatus;
        if(curSprite == PlayerSprite)
        {
          if(PreSprite != PlayerSprite)
          {
            count = 1;
          }
          else count++;
          if(count == 5)
            return true;
        }
        else count = 0;

        PreSprite = curSprite;
      }

      #check diagonal left-up to right-down
      PreSprite = "*";
      count = 0;
      int leftup[2];
      int leftupDistance = min(4, position[0], position[1])
      leftup[0] = position[0] - leftupDistance;
      leftup[1] = position[1] - leftupDistance;

      int rightdown[2];
      int rightdownDistance = min(4, MapSize[0] - 1 - position[0], MapSize[1] - 1 - position[1]);
      rightdown[0] = position[0] + rightdownDistance;
      rightdown[1] = position[1] + rightdownDistance;

      int curposition[2];
      
      for(int i = 0; i <= (rightdown[0] - leftup[0]); i++)
      {
        curposition[0] = leftup[0] + i;
        curposition[1] = leftup[1] + i;
        string curSprite = Text@SpriteList[curposition[0]][curposition[1]]@GobangStatus;
        if(curSprite == PlayerSprite)
        {
          if(PreSprite != PlayerSprite)
          {
            count = 1;
          }
          else count++;
          if(count == 5)
            return true;
        }
        else count = 0;

        PreSprite = curSprite;
      }

      #check diagonal left-down to right-up
      PreSprite = "*";
      count = 0;
      int leftdown[2];
      int leftdownDistance = min(4, position[0], MapSize[1] - 1 - position[1])
      leftdown[0] = position[0] - leftdownDistance;
      leftdown[1] = position[1] + leftdownDistance;

      int rightup[2];
      int rightupDistance = min(4, MapSize[0] - 1 - position[0], position[1]);
      rightup[0] = position[0] + rightupDistance;
      rightup[1] = position[1] - rightupDistance;

      int curposition[2];
      
      for(int i = 0; i <= (rightup[0] - leftdown[0]); i++)
      {
        curposition[0] = leftdown[0] + i;
        curposition[1] = leftdown[1] - i;
        string curSprite = Text@SpriteList[curposition[0]][curposition[1]]@GobangStatus;
        if(curSprite == PlayerSprite)
        {
          if(PreSprite != PlayerSprite)
          {
            count = 1;
          }
          else count++;
          if(count == 5)
            return true;
        }
        else count = 0;
        
        PreSprite = curSprite;
      }
      
      return false;
    }
    
    #bool isLegal(Status s, Move nextmove)
    bool isLegal(Status GobangStatus, int position)
    {
      if(not (position[0]>=0 and position[0]<MapSize[0] and position[1]>=0 and position[1]<MapSize[1]))
        return false;
      if(Text@SpriteList[position[0]][position[1]]@GobangStatus@mygame == "*")
        return true;
      else return false;
    }
    
    void update(int InputPosition)
    {
        ID@SpriteList[InputPosition[0]][InputPosition[1]]@GobangStatus = NextSpriteID@GobangStatus;
        OwnerId@SpriteList[InputPosition[0]][InputPosition[1]]@GobangStatus = NextPlayerID@GobangStatus;
        Text@SpriteList[InputPosition[0]][InputPosition[1]]@GobangStatus = PlayerSpriteName@PlayerList[NextPlayerID];
        FormerId@GobangStatus = NextPlayerID@GobangStatus;
        FormerPosition[0]@GobangStatus = InputPosition[0];
        FormerPosition[1]@GobangStatus = InputPosition[1];
        NextSpriteID@GobangStatus = NextSpriteID@GobangStatus + 1;
        NextPlayerID@GobangStatus = NextPlayerID@GobangStatus + 1;
        if(NextPlayerID@GobangStatus == PlayerNumber)
            NextPlayerID@GobangStatus = 0;
    }
    
    void printGame();
    #for(int i = 0; i < MapSize[0]; i++)
    {
      for(int j = 0; j < MapSize[1]; j++)
      {
        print(Text@SpriteList[i][j]@GobangStatus@mygame);
      }
      print("\n");
    }

}


#assume the input stream is stdin>>...
class UserMain extends Main{
  void main()
  {
      Gobang mygame;
      int MapS[2] = {15, 15};
      int PlayerNum = 2;
      Player PlayerL[2] = {(0, "Cuidiao", "C"), (1, "Xicao", "X")};

      string Blanksignal = "*";
      initialize(MapS, PlayerNum, InputPlayerID, Blanksignal)@mygame;
      printGame()@mygame;
      
      while(not win()@mygame)
      {
          print("This is the turn of player");
          print(NextPlayerID@GobangStatus@mygame);
          
          #input position
          int InputPosition[2];
          bool legal = false;
          while(not legal)
          {
            stdin>>InputPosition[0];
            stdin>>InputPosition[1];
            legal = isLegal(InputPosition)@mygame;
          }
          
          #update status
          update(InputPosition)@mygame;;

          #print map
          printGame()@mygame;
      }
      #print
      int winner = NextPlayerID - 1;
      print("Winner is: ");
      print(winner);
  }
}